###############################################################################
# Online Local Mart - Nagios object definitions
# - Monitors backend HTTP health
# - Checks container uptime and resource usage via custom plugins
# This file is included by nagios.cfg via a small include in commands dir.
###############################################################################

define host {
    use                     linux-server
    host_name               docker-host
    alias                   Local Docker Host
    address                 127.0.0.1
    register                1
}

# HTTP health check for backend
define service {
    use                     generic-service
    host_name               docker-host
    service_description     Backend HTTP
    check_command           check_http!-H localhost -p $USER3$ -u /
    # $USER3$ will be replaced by APP_PORT via resource.cfg include (see commands include)
}

# Ensure backend container is running
define service {
    use                     generic-service
    host_name               docker-host
    service_description     Backend Container Uptime
    check_command           check_container_running!backend
}

# CPU usage warning/critical thresholds are adjustable via args
define service {
    use                     generic-service
    host_name               docker-host
    service_description     Backend CPU Usage
    check_command           check_container_cpu!backend!80!95
}

# Memory usage warning/critical thresholds are adjustable via args
define service {
    use                     generic-service
    host_name               docker-host
    service_description     Backend Memory Usage
    check_command           check_container_mem!backend!75!90
}

# Optional MongoDB checks (only meaningful if profile 'db' is running)
define service {
    use                     generic-service
    host_name               docker-host
    service_description     MongoDB Container Uptime
    check_command           check_container_running!mongodb
}


